<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SMASH WHO?</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #2a2a40);
      color: #f5f5f5;
      text-align: center;
      margin: 0;
      padding: 20px;
      padding-bottom: 80px;
    }
    h1, h2 {
      color: #fff;
      text-shadow: 0 0 10px #ff00ff88;
      margin: 10px 0;
    }
    .tagline {
      font-size: 1.3em;
      color: #ccc;
      margin-top: -5px;
      margin-bottom: 15px;
      text-shadow: 0 0 5px #ff00ff55;
    }
    .emoji {
      font-size: 1.5em;
      vertical-align: middle;
      margin-right: 5px;
    }
    #vote-counter {
      font-size: 1.1em;
      margin-bottom: 5px;
      color: #ff00ff;
      font-weight: bold;
      text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }
    #reset-timer {
      font-size: 0.95em;
      color: #bbb;
      margin-bottom: 20px;
    }
    .choice-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .choice {
      background: rgba(30, 30, 47, 0.9);
      padding: 25px 30px;
      border-radius: 15px;
      box-shadow: 0 0 10px #000;
      cursor: pointer;
      font-size: 1.5em;
      font-weight: bold;
      transition: transform 0.2s ease, background-color 0.2s ease, opacity 0.3s ease, box-shadow 0.3s ease;
      min-width: 140px;
      max-width: 90%;
      word-wrap: break-word;
    }
    .choice:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px var(--hover-color, #00f0ff);
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
    }
    .shake { animation: shake 0.15s; }
    .winner {
      background-color: rgba(0, 255, 100, 0.3) !important;
      transform: scale(1.1);
      box-shadow: 0 0 20px #00ff88;
    }
    .loser {
      background-color: rgba(255, 50, 50, 0.3) !important;
      transform: scale(0.95);
      opacity: 0.7;
    }
    .fade-out {
      opacity: 0 !important;
      transform: scale(0.9);
    }
    .fade-in {
      opacity: 0;
      animation: fadeInAnim 0.2s forwards;
    }
    @keyframes fadeInAnim { to { opacity: 1; } }
    button {
      padding: 14px 20px;
      border: none;
      background: #9b00ff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      margin: 8px;
      font-weight: bold;
      font-size: 1.1em;
      text-shadow: 0 0 5px rgba(255,255,255,0.7);
      transition: box-shadow 0.3s ease, transform 0.2s ease;
    }
    button:hover {
      box-shadow: 0 0 20px var(--hover-color, #00f0ff);
      transform: scale(1.05);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .danger { background: #ff0044; }
    #leaderboard {
      margin-top: 30px;
      overflow-x: auto;
    }
    table {
      border-collapse: collapse;
      background: rgba(30, 30, 47, 0.9);
      box-shadow: 0 0 15px #000;
      border-radius: 10px;
      overflow: hidden;
      min-width: 300px;
      margin: auto;
      color: #fff;
    }
    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    th {
      background: rgba(255,255,255,0.1);
      color: #00f0ff;
    }
    .gold { background-color: rgba(255, 215, 0, 0.15); font-weight: bold; }
    .silver { background-color: rgba(192, 192, 192, 0.15); font-weight: bold; }
    .bronze { background-color: rgba(205, 127, 50, 0.15); font-weight: bold; }
    .sticky-bar {
      display: flex;
      gap: 8px;
    }
    @media (max-width: 600px) {
      .sticky-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(20, 20, 30, 0.8);
        backdrop-filter: blur(6px);
        padding: 8px calc(8px + env(safe-area-inset-right)) 8px calc(8px + env(safe-area-inset-left));
        box-shadow: 0 -2px 10px rgba(0,0,0,0.4);
        display: flex;
        gap: 8px;
        box-sizing: border-box;
      }
      .sticky-bar button {
        flex: 1;
        margin: 0;
        font-size: 0.95em;
        padding: 12px 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }
    /* Rain Canvas */
    #rainCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: transparent;
    }
  </style>
</head>
<body>
  <canvas id="rainCanvas"></canvas>
  <h1>SMASH WHO? üòçü•µ</h1>
  <p class="tagline"><span class="emoji"></span> Welcome to SMASH OR PASS duos ‚Äî an anonymous choosing app where players pick between two random hotties.</p>
  <div id="vote-counter">Votes left: 10/10</div>
  <div id="reset-timer">Next reset in: 3h 00m 00s</div>
  <div class="choice-container">
    <div class="choice" id="choice1"></div>
    <div class="choice" id="choice2"></div>
  </div>
  <div class="sticky-bar">
    <button id="skipBtn" onclick="skipRound()">Skip</button>
    <button onclick="suggestName()">Suggest Name</button>
  </div>
  <div id="leaderboard">
    <h2>Leaderboard</h2>
    <table>
      <thead><tr><th>Rank</th><th>Name</th><th>Votes</th></tr></thead>
      <tbody id="leaderboard-body"></tbody>
    </table>
  </div>
  <button class="danger" onclick="resetLeaderboard()">Reset Leaderboard</button>
  <button onclick="reviewSuggestions()">Review Suggestions</button>
  <div id="suggestions-panel" style="margin-top:20px;"></div>

  <!-- Firebase Voting Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, query, orderBy, onSnapshot, writeBatch, addDoc, serverTimestamp, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAzDUM_vivcTLN7dGMKEeBYMFR5Wp4dKH8",
      authDomain: "boporbaddie.firebaseapp.com",
      projectId: "boporbaddie",
      storageBucket: "boporbaddie.firebasestorage.app",
      messagingSenderId: "32915423043",
      appId: "1:32915423043:web:8ecb3ced9d82e122dc79f6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let allPeople = [];
    let currentChoices = [];
    let lastChoices = [];
    let animationTimeouts = [];

    function checkVoteReset() {
      let lastReset = parseInt(localStorage.getItem("lastVoteReset") || "0");
      let now = Date.now();
      let threeHours = 3 * 60 * 60 * 1000;
      if (!lastReset || now - lastReset > threeHours) {
        localStorage.setItem("votesUsed", "0");
        localStorage.setItem("lastVoteReset", now.toString());
      }
    }
    function updateVoteCounter() {
      const used = parseInt(localStorage.getItem("votesUsed") || "0");
      document.getElementById("vote-counter").innerText = `Votes left: ${Math.max(0, 10 - used)}/10`;
    }
    function updateResetTimer() {
      let lastReset = parseInt(localStorage.getItem("lastVoteReset") || "0");
      let now = Date.now();
      let threeHours = 3 * 60 * 60 * 1000;
      let nextReset = lastReset + threeHours;
      let diff = Math.max(0, nextReset - now);
      let hours = Math.floor(diff / (1000 * 60 * 60));
      let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      let seconds = Math.floor((diff % (1000 * 60)) / 1000);
      document.getElementById("reset-timer").innerText = `Next reset in: ${hours}h ${minutes.toString().padStart(2,"0")}m ${seconds.toString().padStart(2,"0")}s`;
      if (diff <= 0) {
        checkVoteReset();
        updateVoteCounter();
      }
    }
    setInterval(updateResetTimer, 1000);

    function resetChoices() {
      animationTimeouts.forEach(t => clearTimeout(t));
      animationTimeouts = [];
      document.getElementById("choice1").className = "choice";
      document.getElementById("choice2").className = "choice";
    }
    function setRandomHoverColor(element) {
      const colors = ['#ff00ff', '#00f0ff', '#ff8800'];
      const randomColor = colors[Math.floor(Math.random() * colors.length)];
      element.style.setProperty('--hover-color', randomColor);
    }
    function skipRound() {
      resetChoices();
      nextRound();
    }
    async function initScores() {
      const seedNames = ["Nidhi", "Yachna", "Poorvi", "Ananya", "Neha", "Liri", "Tiya", "Eshanika", "Diya", "Aditi", "Mehak", "Gayatri"];
      for (let person of seedNames) {
        let ref = doc(db, "leaderboard", person);
        let snap = await getDoc(ref);
        if (!snap.exists()) {
          await setDoc(ref, { name: person, votes: 0 });
        }
      }
      checkVoteReset();
      updateVoteCounter();
    }
    function updateLeaderboardLive() {
      const q = query(collection(db, "leaderboard"), orderBy("votes", "desc"));
      onSnapshot(q, snapshot => {
        let tbody = document.getElementById("leaderboard-body");
        tbody.innerHTML = "";
        let rank = 1;
        allPeople = [];
        snapshot.forEach(docSnap => {
          let data = docSnap.data();
          allPeople.push(data.name);
          let rowClass = "";
          let medal = "";
          if (rank === 1) { rowClass = "gold"; medal = "ü•á "; }
          else if (rank === 2) { rowClass = "silver"; medal = "ü•à "; }
          else if (rank === 3) { rowClass = "bronze"; medal = "ü•â "; }
          tbody.innerHTML += `<tr class="${rowClass}"><td>${medal}${rank}</td><td>${data.name}</td><td>${data.votes}</td></tr>`;
          rank++;
        });
        if (currentChoices.length === 0) nextRound();
      });
    }
    function getRandomPerson(excludeList = []) {
      let available = allPeople.filter(p => !excludeList.includes(p));
      return available.length > 0 ? available[Math.floor(Math.random() * available.length)] : null;
    }
    function nextRound() {
      resetChoices();
      const skipBtn = document.getElementById("skipBtn");
      skipBtn.disabled = false;
      if (allPeople.length < 2) {
        document.getElementById("choice1").innerText = "Not enough players";
        document.getElementById("choice2").innerText = "Add more names";
        return;
      }
      let p1 = getRandomPerson(lastChoices);
      let p2 = getRandomPerson([...lastChoices, p1]);
      currentChoices = [p1, p2];
      lastChoices = [p1, p2];
      const c1 = document.getElementById("choice1");
      const c2 = document.getElementById("choice2");
      c1.className = "choice fade-in";
      c2.className = "choice fade-in";
      c1.innerText = p1;
      c2.innerText = p2;
      setRandomHoverColor(c1);
      setRandomHoverColor(c2);
      setTimeout(() => {
        c1.classList.remove("fade-in");
        c2.classList.remove("fade-in");
      }, 200);
    }
    async function pick(index) {
      let votesUsed = parseInt(localStorage.getItem("votesUsed") || "0");
      if (votesUsed >= 10) {
        alert("You've reached the maximum of 10 votes for now. Please wait until your votes reset in 3 hours.");
        return;
      }
      localStorage.setItem("votesUsed", votesUsed + 1);
      updateVoteCounter();
      const skipBtn = document.getElementById("skipBtn");
      skipBtn.disabled = true;
      const chosenId = index === 0 ? "choice1" : "choice2";
      const loserId = index === 0 ? "choice2" : "choice1";
      const chosenEl = document.getElementById(chosenId);
      const loserEl = document.getElementById(loserId);
      chosenEl.classList.add("shake");
      setTimeout(() => {
        chosenEl.classList.remove("shake");
        chosenEl.classList.add("winner");
        loserEl.classList.add("loser");
      }, 150);
      let chosen = currentChoices[index];
      let ref = doc(db, "leaderboard", chosen);
      await updateDoc(ref, { votes: increment(1) });
      setTimeout(() => {
        chosenEl.classList.add("fade-out");
        loserEl.classList.add("fade-out");
      }, 350);
      setTimeout(() => {
        nextRound();
      }, 550);
    }
    async function resetLeaderboard() {
      resetChoices();
      const adminCode = "secret123";
      if (prompt("Enter admin reset code:") !== adminCode) return alert("Incorrect code!");
      if (!confirm("Are you sure you want to reset all votes?")) return;
      const batch = writeBatch(db);
      allPeople.forEach(person => {
        batch.update(doc(db, "leaderboard", person), { votes: 0 });
      });
      await batch.commit();
      alert("Leaderboard has been reset!");
    }
    async function suggestName() {
      resetChoices();
      const name = prompt("Enter the name you want to suggest:");
      if (!name || name.trim() === "") return alert("Name cannot be empty.");
      await addDoc(collection(db, "suggestions"), { name: name.trim(), timestamp: serverTimestamp() });
      alert("Your suggestion has been sent for review!");
    }
    async function reviewSuggestions() {
      resetChoices();
      const adminCode = "secret123";
      if (prompt("Enter admin code:") !== adminCode) return alert("Incorrect code!");
      const suggestionsDiv = document.getElementById("suggestions-panel");
      suggestionsDiv.innerHTML = "<h3>Pending Suggestions</h3>";
      const snap = await getDocs(collection(db, "suggestions"));
      if (snap.empty) return suggestionsDiv.innerHTML += "<p>No pending suggestions.</p>";
      snap.forEach(docSnap => {
        const { name } = docSnap.data();
        const id = docSnap.id;
        suggestionsDiv.innerHTML += `
          <div class="suggestion-card">
            <strong>${name}</strong><br>
            <button onclick="approveSuggestion('${id}', '${name}')">Approve</button>
            <button onclick="rejectSuggestion('${id}')">Reject</button>
          </div>
        `;
      });
    }
    async function approveSuggestion(id, name) {
      resetChoices();
      await setDoc(doc(db, "leaderboard", name), { name: name, votes: 0 });
      await deleteDoc(doc(db, "suggestions", id));
      alert(`Approved and added "${name}" to leaderboard!`);
      reviewSuggestions();
    }
    async function rejectSuggestion(id) {
      resetChoices();
      await deleteDoc(doc(db, "suggestions", id));
      alert("Suggestion rejected.");
      reviewSuggestions();
    }
    document.getElementById("choice1").addEventListener("click", () => pick(0));
    document.getElementById("choice2").addEventListener("click", () => pick(1));
    initScores().then(() => updateLeaderboardLive());
    window.skipRound = skipRound;
    window.resetLeaderboard = resetLeaderboard;
    window.suggestName = suggestName;
    window.reviewSuggestions = reviewSuggestions;
    window.approveSuggestion = approveSuggestion;
    window.rejectSuggestion = rejectSuggestion;
  </script>

  <!-- Purple Rain Background Script -->
  <script>
    const rainCanvas = document.getElementById("rainCanvas");
    const ctx = rainCanvas.getContext("2d");
    let width, height;
    function resizeCanvas() {
      width = rainCanvas.width = window.innerWidth;
      height = rainCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    class Raindrop {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * width;
        this.y = Math.random() * -height;
        this.length = Math.random() * 15 + 10;
        this.speed = Math.random() * 4 + 2;
        this.opacity = Math.random() * 0.2 + 0.1;
      }
      update() {
        this.y += this.speed;
        if (this.y > height) this.reset();
      }
      draw() {
        ctx.beginPath();
        ctx.strokeStyle = `rgba(200, 0, 255, ${this.opacity})`;
        ctx.lineWidth = 1.2;
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x, this.y + this.length);
        ctx.shadowBlur = 8;
        ctx.shadowColor = "rgba(200, 0, 255, 0.6)";
        ctx.stroke();
      }
    }
    const drops = [];
    for (let i = 0; i < 120; i++) drops.push(new Raindrop());
    function animateRain() {
      ctx.clearRect(0, 0, width, height);
      for (let drop of drops) {
        drop.update();
        drop.draw();
      }
      requestAnimationFrame(animateRain);
    }
    animateRain();
  </script>
</body>
</html>
