<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>People Picker</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #2a2a40);
      color: #f5f5f5;
      text-align: center;
      padding: 30px;
    }
    h1, h2 {
      color: #fff;
      text-shadow: 0 0 10px #ff00ff88;
    }
    .tagline {
      font-size: 1.1em;
      color: #ccc;
      margin-top: -10px;
      margin-bottom: 30px;
      text-shadow: 0 0 5px #ff00ff55;
    }
    .emoji {
      font-size: 1.5em;
      vertical-align: middle;
      margin-right: 5px;
    }
    .choice-container {
      display: flex;
      justify-content: center;
      gap: 60px;
      margin: 40px 0;
    }
    .choice {
      background: rgba(30, 30, 47, 0.9);
      padding: 30px 50px;
      border-radius: 15px;
      box-shadow: 0 0 10px #000;
      cursor: pointer;
      font-size: 1.5em;
      transition: transform 0.2s ease, background-color 0.2s ease, opacity 0.3s ease, box-shadow 0.3s ease;
      opacity: 1;
      min-width: 150px;
    }
    .choice:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px var(--hover-color, #00f0ff);
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
    }
    .shake { animation: shake 0.15s; }
    .winner {
      background-color: rgba(0, 255, 100, 0.3) !important;
      transform: scale(1.1);
      box-shadow: 0 0 20px #00ff88;
    }
    .loser {
      background-color: rgba(255, 50, 50, 0.3) !important;
      transform: scale(0.95);
      opacity: 0.7;
    }
    .fade-out {
      opacity: 0 !important;
      transform: scale(0.9);
    }
    .fade-in {
      opacity: 0;
      animation: fadeInAnim 0.2s forwards;
    }
    @keyframes fadeInAnim { to { opacity: 1; } }
    button {
      padding: 12px 24px;
      border: none;
      background: #9b00ff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      margin: 8px;
      font-weight: bold;
      transition: box-shadow 0.3s ease, transform 0.2s ease;
    }
    button:hover {
      box-shadow: 0 0 20px var(--hover-color, #00f0ff);
      transform: scale(1.05);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    .danger {
      background: #ff0044;
    }
    .danger:hover {
      box-shadow: 0 0 20px #ff0044;
    }
    table {
      margin: auto;
      border-collapse: collapse;
      background: rgba(30, 30, 47, 0.9);
      box-shadow: 0 0 15px #000;
      border-radius: 10px;
      overflow: hidden;
      color: #fff;
    }
    th, td {
      padding: 12px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    th {
      background: rgba(255,255,255,0.1);
      color: #00f0ff;
    }
    .gold { background-color: rgba(255, 215, 0, 0.15); font-weight: bold; }
    .silver { background-color: rgba(192, 192, 192, 0.15); font-weight: bold; }
    .bronze { background-color: rgba(205, 127, 50, 0.15); font-weight: bold; }
    .suggestion-card {
      background: rgba(30, 30, 47, 0.9);
      padding: 10px;
      margin: 10px auto;
      width: 300px;
      border-radius: 8px;
      box-shadow: 0 0 10px #000;
      color: #fff;
    }
  </style>
</head>
<body>

  <h1>Pick One!</h1>
  <p class="tagline">
    <span class="emoji">üòçü•µ</span> Welcome to SMASH OR PASS duos ‚Äî an anonymous choosing app where players pick between two random baddies (or uggos).<br>
    Every pick counts towards the public leaderboard. No sign-ups, no tracking ‚Äî just pure fun HAHHAH.
  </p>

  <div class="choice-container">
    <div class="choice" id="choice1"></div>
    <div class="choice" id="choice2"></div>
  </div>
  <button id="skipBtn" onclick="skipRound()">Skip</button>

  <div id="leaderboard">
    <h2>Leaderboard</h2>
    <table>
      <thead><tr><th>Rank</th><th>Name</th><th>Votes</th></tr></thead>
      <tbody id="leaderboard-body"></tbody>
    </table>
  </div>

  <button class="danger" onclick="resetLeaderboard()">Reset Leaderboard</button>
  <button onclick="suggestName()">Suggest a Name</button>
  <button onclick="reviewSuggestions()">Review Suggestions</button>

  <div id="suggestions-panel" style="margin-top:20px;"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, query, orderBy, onSnapshot, writeBatch, addDoc, serverTimestamp, deleteDoc, getDocs } 
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAzDUM_vivcTLN7dGMKEeBYMFR5Wp4dKH8",
      authDomain: "boporbaddie.firebaseapp.com",
      projectId: "boporbaddie",
      storageBucket: "boporbaddie.firebasestorage.app",
      messagingSenderId: "32915423043",
      appId: "1:32915423043:web:8ecb3ced9d82e122dc79f6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const seedNames = [
      "Nidhi", "Yachna", "Poorvi", "Ananya",
      "Neha", "Liri", "Tiya", "Eshanika",
      "Diya", "Aditi", "Mehak", "Gayatri"
    ];

    let allPeople = [];
    let currentChoices = [];
    let lastChoices = [];
    let animationTimeouts = [];

    function resetChoices() {
      animationTimeouts.forEach(t => clearTimeout(t));
      animationTimeouts = [];
      const c1 = document.getElementById("choice1");
      const c2 = document.getElementById("choice2");
      c1.className = "choice";
      c2.className = "choice";
    }

    function setRandomHoverColor(element) {
      const colors = ['#ff00ff', '#00f0ff', '#ff8800']; // no red or green
      const randomColor = colors[Math.floor(Math.random() * colors.length)];
      element.style.setProperty('--hover-color', randomColor);
    }

    function skipRound() {
      resetChoices();
      nextRound();
    }

    async function initScores() {
      for (let person of seedNames) {
        let ref = doc(db, "leaderboard", person);
        let snap = await getDoc(ref);
        if (!snap.exists()) {
          await setDoc(ref, { name: person, votes: 0 });
        }
      }
    }

    function updateLeaderboardLive() {
      const q = query(collection(db, "leaderboard"), orderBy("votes", "desc"));
      onSnapshot(q, snapshot => {
        let tbody = document.getElementById("leaderboard-body");
        tbody.innerHTML = "";
        let rank = 1;
        allPeople = [];
        snapshot.forEach(docSnap => {
          let data = docSnap.data();
          allPeople.push(data.name);
          let rowClass = "";
          let medal = "";
          if (rank === 1) { rowClass = "gold"; medal = "ü•á "; }
          else if (rank === 2) { rowClass = "silver"; medal = "ü•à "; }
          else if (rank === 3) { rowClass = "bronze"; medal = "ü•â "; }
          tbody.innerHTML += `<tr class="${rowClass}"><td>${medal}${rank}</td><td>${data.name}</td><td>${data.votes}</td></tr>`;
          rank++;
        });
        if (currentChoices.length === 0) nextRound();
      });
    }

    function getRandomPerson(excludeList = []) {
      let available = allPeople.filter(p => !excludeList.includes(p));
      return available.length > 0
        ? available[Math.floor(Math.random() * available.length)]
        : null;
    }

    function nextRound() {
      resetChoices();
      const skipBtn = document.getElementById("skipBtn");
      skipBtn.disabled = false;

      if (allPeople.length < 2) {
        document.getElementById("choice1").innerText = "Not enough players";
        document.getElementById("choice2").innerText = "Add more names";
        return;
      }

      let p1 = getRandomPerson(lastChoices);
      let p2 = getRandomPerson([...lastChoices, p1]);
      currentChoices = [p1, p2];
      lastChoices = [p1, p2];

      const c1 = document.getElementById("choice1");
      const c2 = document.getElementById("choice2");
      c1.className = "choice fade-in";
      c2.className = "choice fade-in";
      c1.innerText = p1;
      c2.innerText = p2;
      setRandomHoverColor(c1);
      setRandomHoverColor(c2);

      animationTimeouts.push(setTimeout(() => {
        c1.classList.remove("fade-in");
        c2.classList.remove("fade-in");
      }, 200));
    }

    async function pick(index) {
      const skipBtn = document.getElementById("skipBtn");
      skipBtn.disabled = true;

      const chosenId = index === 0 ? "choice1" : "choice2";
      const loserId = index === 0 ? "choice2" : "choice1";
      const chosenEl = document.getElementById(chosenId);
      const loserEl = document.getElementById(loserId);

      chosenEl.classList.add("shake");
      animationTimeouts.push(setTimeout(() => {
        chosenEl.classList.remove("shake");
        chosenEl.classList.add("winner");
        loserEl.classList.add("loser");
      }, 150));

      let chosen = currentChoices[index];
      let ref = doc(db, "leaderboard", chosen);
      await updateDoc(ref, { votes: increment(1) });

      animationTimeouts.push(setTimeout(() => {
        chosenEl.classList.add("fade-out");
        loserEl.classList.add("fade-out");
      }, 350));

      animationTimeouts.push(setTimeout(() => {
        nextRound();
      }, 550));
    }

    // Buttons and suggestion handling
    async function resetLeaderboard() {
      resetChoices();
      const adminCode = "secret123";
      const entered = prompt("Enter admin reset code:");
      if (entered !== adminCode) {
        alert("Incorrect code!");
        return;
      }
      if (!confirm("Are you sure you want to reset all votes?")) return;
      const batch = writeBatch(db);
      allPeople.forEach(person => {
        const ref = doc(db, "leaderboard", person);
        batch.update(ref, { votes: 0 });
      });
      await batch.commit();
      alert("Leaderboard has been reset!");
    }

    async function suggestName() {
      resetChoices();
      const name = prompt("Enter the name you want to suggest:");
      if (!name || name.trim() === "") {
        alert("Name cannot be empty.");
        return;
      }
      await addDoc(collection(db, "suggestions"), {
        name: name.trim(),
        timestamp: serverTimestamp()
      });
      alert("Your suggestion has been sent for review!");
    }

    async function reviewSuggestions() {
      resetChoices();
      const adminCode = "secret123";
      const entered = prompt("Enter admin code:");
      if (entered !== adminCode) {
        alert("Incorrect code!");
        return;
      }
      const suggestionsDiv = document.getElementById("suggestions-panel");
      suggestionsDiv.innerHTML = "<h3>Pending Suggestions</h3>";
      const snap = await getDocs(collection(db, "suggestions"));
      if (snap.empty) {
        suggestionsDiv.innerHTML += "<p>No pending suggestions.</p>";
        return;
      }
      snap.forEach(docSnap => {
        const data = docSnap.data();
        const name = data.name;
        const id = docSnap.id;
        const card = document.createElement("div");
        card.className = "suggestion-card";
        card.innerHTML = `
          <strong>${name}</strong><br>
          <button onclick="approveSuggestion('${id}', '${name}')">Approve</button>
          <button onclick="rejectSuggestion('${id}')">Reject</button>
        `;
        suggestionsDiv.appendChild(card);
      });
    }

    async function approveSuggestion(id, name) {
      resetChoices();
      await setDoc(doc(db, "leaderboard", name), { name: name, votes: 0 });
      await deleteDoc(doc(db, "suggestions", id));
      alert(`Approved and added "${name}" to leaderboard!`);
      reviewSuggestions();
    }

    async function rejectSuggestion(id) {
      resetChoices();
      await deleteDoc(doc(db, "suggestions", id));
      alert("Suggestion rejected.");
      reviewSuggestions();
    }

    // Event listeners
    document.getElementById("choice1").addEventListener("click", () => pick(0));
    document.getElementById("choice2").addEventListener("click", () => pick(1));

    initScores().then(() => {
      updateLeaderboardLive();
    });

    window.skipRound = skipRound;
    window.resetLeaderboard = resetLeaderboard;
    window.suggestName = suggestName;
    window.reviewSuggestions = reviewSuggestions;
    window.approveSuggestion = approveSuggestion;
    window.rejectSuggestion = rejectSuggestion;
  </script>
</body>
</html>
